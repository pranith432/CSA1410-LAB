%{
#include <stdio.h>

int char_count = 0;
int word_count = 0;
int line_count = 0;
int in_word = 0;

void remove_comments();

%}

%x COMMENT

%%
"//".*               {/* single-line comment, ignore */}
"/*"                 { BEGIN(COMMENT); }
<COMMENT>"*/"        { BEGIN(INITIAL); }
<COMMENT>.|\n        { /* skip all characters in comment */ }

[ \t]+               { /* ignore redundant spaces/tabs */ }
\n                   { line_count++; in_word = 0; }
.                    {
                        char_count++;
                        if ( (yytext[0] >= 'a' && yytext[0] <= 'z') ||
                             (yytext[0] >= 'A' && yytext[0] <= 'Z') ||
                             (yytext[0] >= '0' && yytext[0] <= '9') ||
                             (yytext[0] == '_') ) {
                            if (!in_word) {
                                word_count++;
                                in_word = 1;
                            }
                        } else {
                            in_word = 0;
                        }
                    }
%%

int yywrap() { return 1; }

int main(int argc, char *argv[]) {
    if (argc < 2) {
        printf("Usage: %s <inputfile.c>\n", argv[0]);
        return 1;
    }
    FILE *f = fopen(argv[1], "r");
    if (!f) {
        perror("File open error");
        return 1;
    }
    yyin = f;
    yylex();
    fclose(f);

    printf("Characters (excluding spaces, tabs, newlines, comments): %d\n", char_count);
    printf("Words: %d\n", word_count);
    printf("Lines: %d\n", line_count);
    return 0;
}
